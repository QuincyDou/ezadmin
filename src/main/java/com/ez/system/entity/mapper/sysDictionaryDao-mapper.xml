<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ez.system.dao.SysDictionaryDao">

    <resultMap id="SysDictionary" type="com.ez.system.entity.SysDictionary">
        <result property="id" column="ID"/>
        <result property="code" column="CODE"/>
        <result property="sdkey" column="SD_KEY"/>
        <result property="sdvalue" column="SD_VALUE"/>
        <result property="remark" column="REMARK"/>
    </resultMap>

    <sql id="selectId">
        ID,
        CODE,
        SD_KEY,
        SD_VALUE,
        REMARK
    </sql>

    <select id="query" resultMap="SysDictionary">
        select
        <include refid="selectId"/>
        from sys_dictionary
        <include refid="querywhere"/>
        <!--<if test="@Ognl@isNotEmpty(t.sort) and @Ognl@isNotEmpty(t.direction)">
            order by ${t.sort} ${t.direction}
        </if>-->

    </select>
    <sql id="querywhere">
        <!-- ognl访问静态方法的表达式 为@class@method(args),以下为调用Ognl.isNotEmpty()方法,还有其它方法如isNotBlank()可以使用，具体请查看Ognl类 -->
        <where>
            <if test="@Ognl@isNotEmpty(t.code)">
                AND CODE like '%${t.code}%'
            </if>
            <if test="@Ognl@isNotEmpty(t.sdkey)">
                AND SD_KEY like '%${t.sdkey}%'
            </if>
            <if test="@Ognl@isNotEmpty(t.sdvalue)">
                AND SD_VALUE like '%${t.sdvalue}%'
            </if>
            <if test="@Ognl@isNotEmpty(t.remark)">
                AND REMARK like '%${t.remark}%'
            </if>

        </where>
    </sql>
    <!-- chenze  end -->

    <!-- chenze  start -->
    <!-- 新增Selective -->
    <insert id="add" parameterType="com.ez.system.entity.SysDictionary">
        <selectKey resultType="java.lang.Integer"  order="AFTER" keyProperty="id" >
            SELECT LAST_INSERT_ID() AS ID
        </selectKey>
        INSERT INTO sys_dictionary
        <include refid="addtrim"/>
    </insert>

    <sql id="addtrim">
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="@Ognl@isNotEmpty(code)">
                CODE,
            </if>
            <if test="@Ognl@isNotEmpty(sdkey)">
                SD_KEY,
            </if>
            <if test="@Ognl@isNotEmpty(sdvalue)">
                SD_VALUE,
            </if>
            <if test="@Ognl@isNotEmpty(remark)">
                REMARK,
            </if>
        </trim>
        <trim prefix=" values (" suffix=")" suffixOverrides="," >
            <if test="@Ognl@isNotEmpty(code)">
                #{code},
            </if>
            <if test="@Ognl@isNotEmpty(sdkey)">
                #{sdkey},
            </if>
            <if test="@Ognl@isNotEmpty(sdvalue)">
                #{sdvalue},
            </if>
            <if test="@Ognl@isNotEmpty(remark)">
                #{remark},
            </if>
        </trim>
    </sql>

    <!-- 根据主键查实体 -->
    <select id="findByCode" parameterType="String" resultMap="SysDictionary">
        SELECT
        <include refid="selectId" />
        FROM sys_dictionary
        WHERE
        ID = #{id}
    </select>

    <!-- 更新all -->
    <update id="modify" parameterType="com.ez.system.entity.SysDictionary">
        UPDATE sys_dictionary SET
        CODE = #{code} ,
        SD_KEY = #{sdkey} ,
        SD_VALUE = #{sdvalue} ,
        REMARK = #{remark}
        WHERE
        ID = #{id}
    </update>

    <select id="findByCodeAndValue" resultMap="SysDictionary">
        SELECT
        <include refid="selectId" />
        FROM sys_dictionary
        WHERE
        CODE = #{code} and
        (SD_VALUE = #{sdvalue} or SD_KEY = #{sdkey} )

    </select>
    <!-- chenze  end -->

    <select id="findSdBySdtCode" parameterType="String" resultMap="SysDictionary">
        select
        <include refid="selectId" />
        from sys_dictionary
        where code = #{code}
        order by sd_value
    </select>

    <select id="findSdBySdtCode2" parameterType="com.ez.system.entity.SysDictionary" resultMap="SysDictionary">
        select
        <include refid="selectId" />
        from sys_dictionary
        where code = #{code} and substring(sd_value,1,1)=#{sdvalue}
    </select>

    <select id="findKeyByCodeAndValue" parameterType="com.ez.system.entity.SysDictionary" resultMap="SysDictionary">
        select
        <include refid="selectId"/>
        from sys_dictionary
        where code = #{code} and sd_value = #{sdvalue}
    </select>
</mapper>